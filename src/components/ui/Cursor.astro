<div id="cursor" class="cursor" data-astro-transition-persist></div>

<script>
    const isMobile =
      /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(
        navigator.userAgent
      );

    if (!isMobile) {
      let cursor = document.getElementById("cursor");
      let cursorX = 0,
        cursorY = 0;
      let targetX = 0,
        targetY = 0;
      let lastTimestamp = 0;
      let currentTime = 0;
      let followSpeed = 0.02;
      let frameCounter = 0;
      const frameInterval = 5;

      function easeOutQuad(t) {
        return t * (2 - t);
      }

      function lerp(a, b, t) {
        return a + (b - a) * t;
      }

      function updateCursor(e) {
        targetX = e.clientX;
        targetY = e.clientY;
      }

      function animate(timestamp) {
        const elapsed = timestamp - lastTimestamp;
        lastTimestamp = timestamp;

        currentTime += elapsed * followSpeed;
        const t = Math.min(1, currentTime);

        cursorX = lerp(cursorX, targetX, easeOutQuad(t));
        cursorY = lerp(cursorY, targetY, easeOutQuad(t));

        frameCounter++;

        if (frameCounter >= frameInterval) {
          cursor.style.transform = `translate(${cursorX}px, ${cursorY}px)`;
          frameCounter = 0;
        }

        if (t >= 1) {
          currentTime = 0;
        }

        requestAnimationFrame(animate);
      }

      function onMouseEnterLink() {
        cursor.style.background = "rgba(0,0,0,0.65)";
        cursor.style.setProperty("--cursor-size", "30px");
      }

      function onMouseLeaveLink() {
        cursor.style.background = "#000";
        cursor.style.setProperty("--cursor-size", "15px");
      }

      cursor.style.transform = `translate(${window.innerWidth / 2}px, ${window.innerHeight / 2}px)`;

      window.addEventListener("mousemove", updateCursor);

      requestAnimationFrame((timestamp) => {
        lastTimestamp = timestamp;
        animate(timestamp);
      });

      document.addEventListener("astro:page-load", () => {
        const links = document.querySelectorAll("a, button, .clickable");
        links.forEach((link) => {
          link.addEventListener("mouseenter", onMouseEnterLink);
          link.addEventListener("mouseleave", onMouseLeaveLink);
        });
      });

      const links = document.querySelectorAll("a, button, .clickable");
      links.forEach((link) => {
        link.addEventListener("mouseenter", onMouseEnterLink);
        link.addEventListener("mouseleave", onMouseLeaveLink);
      });
    }
</script>
